<?php

class WebformSubmissionEntityTestCase extends DrupalWebTestCase {
  protected $privileged_user;

  public static function getInfo() {
    return array(
      'name' => 'Webform Submission Entity',
      'description' => 'Checks that entities are created correctly when a submission is created.',
      'group' => 'Webform Submission Entity',
    );
  }
	
	public function setUp() {
    parent::setUp(array('webform', 'entity'));  // Enable any modules required for the test
    // Create and log in our privileged user.
    $this->privileged_user = $this->drupalCreateUser(array(
      'access content',
      'administer nodes',
      'create webform content',
      'edit any webform content',
      'access all webform results',
      'edit all webform submissions',
      'delete all webform submissions',
      ));
  }
	
	public function testCreateWebformSubmissionEntity() {
   $this->drupalLogin($this->privileged_user);
   variable_set('webform_node_types', array('webform', 'page'));
   $settings = array(
      'title' => $this->randomName(8),
      'type' => 'page',
    );
    $node = $this->drupalCreateNode($settings);
    
    $component = array('form_key' => $this->randomName(8),
    									 'name' => $this->randomName(8),
    									 );
    
    
    $this->drupalPost('node/'. $node->nid .'/webform/components/new/textfield?name='. $component['form_key'] .'&mandatory=0&pid=0&weight=1', $component, t('Save Component'));
    
    $this->drupalGet('node/'. $node->nid);
    $this->assertText($textarea['name']);
  }
	
}