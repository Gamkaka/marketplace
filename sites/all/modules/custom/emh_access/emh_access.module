<?php
/**
* @file
* Code for eMindHub access feature.
*/


function emh_access_profile() {

  // TODO: use User role field ?

  $access = FALSE; // We prefer to disallow access rather than allow it !

  global $user;
  $uid = $user->uid;
  $uid2 = $node->uid;

  // Check if the user we want to see is allowing to watch his/her profile
  if ( emh_access_user_name( $node ) == TRUE || emh_access_user_company( $node ) == TRUE ) {

    print 'i can !';
    $access = TRUE;

  }

  // Check if there's any chance to see full profile, no matter what the user had choosen in its profile
  if ( emh_points_user_can_see_full_user( $uid, $uid2 ) == TRUE ) {

    $access = TRUE;

  }

  return $access;
}

function emh_access_user_name( $node ) {

  $access = FALSE;

  // Check node options
  // 0|Display my full name
  // 1|Hide my full name
  $anonymous_mode = field_get_items('node', $node, 'field_anonymous');
  if ($anonymous_mode[0]['value'] == 0) {
    $access = TRUE;
  }

  return $access;
}

function emh_access_user_company( $node ) {

  $access = FALSE;

  // Check node options
  // 0|Display the name
  // 1|Hide the name
  $show_entreprise = field_get_items('node', $node, 'field_show_entreprise');
  if ($show_entreprise[0]['value'] == 0) {
    $access = TRUE;
  }

  return $access;
}
