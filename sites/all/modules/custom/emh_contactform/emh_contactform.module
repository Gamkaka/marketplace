<?php
/**
* @file
* A module that would allow users to add fields
* Created by: Andrei Ghenoiu
* Date: 8/24/12
* Resources from: http://www.pensamientosdivergentes.net/blog/modifying-contact-form-drupal-how-add-field, 			http://www.metaltoad.com/blog/how-add-field-drupal-contact-form
*/

function emh_contactform_help($path, $arg) {
	switch($path) {
		case "admin/help#emh_contactform":
			return '<p>'. t("allows users to add new fields to the site wide contact form - at the moment there is no option to configure it").'</p>';
			break;
	}
}

//this is what actually adds the new fields onto the form
//if you want to add more fields, just add another $form['your_new_field'] line

function emh_contactform_form_contact_site_form_alter(&$form, &$form_state, $form_id) {

	$form['emh_baseline'] = array(
    '#markup' => '<p class="emh-title-baseline">' . t('Want to learn more?') . '<br /><strong>' . t('Leave us a message, we will get back at you within 24h!') . '</strong></p>',
    '#weight' => '-1000', // First !
  );

	$form['civility'] = array(
		// '#title' => t('Civility'),
		'#title_display' => 'invisible',
		'#type' => 'select',
		'#options' => array(t('Mr'), t('Mrs'), t('Ms')),
		'#required' => TRUE,
	);

	$form['firstname'] = array(
		// '#title' => t('Your first name'),
		'#title_display' => 'invisible',
		'#type' => 'textfield',
		'#required' => TRUE,
		'#attributes' => array(
			'placeholder' => t('Your first name'),
		),
	);

	$form['lastname'] = array(
		// '#title' => t('Your last name'),
		'#title_display' => 'invisible',
		'#type' => 'textfield',
		'#required' => TRUE,
		'#attributes' => array(
			'placeholder' => t('Your last name'),
		),
	);

	$form['entreprise'] = array(
		// '#title' => t('Your organisation'),
		'#title_display' => 'invisible',
		'#type' => 'textfield',
		//'#required' => TRUE,
		'#attributes' => array(
			'placeholder' => t('Your organisation'),
		),
	);

	$form['phone'] = array(
		// '#title' => t('Your phone'),
		'#title_display' => 'invisible',
		'#type' => 'textfield',
		'#required' => TRUE,
		'#attributes' => array(
			'placeholder' => t('Your phone'),
		),
	);

	$form['mail'] = array(
		'#title_display' => 'invisible',
		'#type' => 'textfield',
		'#required' => TRUE,
		'#attributes' => array(
			'placeholder' => t('Your email'),
		),
	);

	$form['message'] = array(
		'#title_display' => 'invisible',
		'#type' => 'textarea',
		'#required' => TRUE,
		'#attributes' => array(
			'placeholder' => t('Your message'),
		),
	);

	$form['name']['#required'] = FALSE;
	$form['name']['#type'] = 'hidden';

	$form['cid']['#type'] = 'hidden';

	$form['subject']['#required'] = FALSE;
	$form['subject']['#type'] = 'hidden';

	$form['copy']['#type'] = 'hidden';

	$form['actions']['submit']['#value'] = t('Send');

	$form['#token'] = NULL;

	$order = array('name', 'mail', 'subject','location', 'cid', 'message', 'copy', 'actions');

	foreach ($order as $key => $field) {
		$form[$field]['#weight'] = $key;
	}

	// echo '<pre>' . print_r($form, TRUE) . '</pre>';

}

function emh_contactform_mail_alter(&$message) {
	if ($message['id'] == 'contact_page_mail') {
		$message['id'] = 'custom_contact_mail'; // Important, otherwise suject will be overriden
	 	$message['subject'] = $message['subject'].' '. t('From').' '.$message['from'];
	 	$message['body'][] = t('From - ').' '.$message['params']['firstname'].' '.$message['params']['lastname'];
		$message['body'][] = t('Telephone').': '.$message['params']['phone'];
		$message['body'][] = t('entreprise').': '.$message['params']['entreprise'];
	}
}
