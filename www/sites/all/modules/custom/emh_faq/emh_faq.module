<?php
/**
* @file
* Code for eMindHub FAQ feature.
*/

/**
 * Implements hook_views_api().
 */
function emh_faq_views_api() {
  return array(
    'api' => 3,
    'path' => drupal_get_path('module', 'emh_faq') . '/views',
  );
}

function emh_faq_reset_views() {
  module_load_include('inc', 'emh_faq', 'views/emh_faq.views_default');
  $default_views = emh_faq_views_default_views();
  foreach($default_views as $name => $view) {
    views_revert_view($view);
  }
}

function emh_faq_form_contact_site_form_alter(&$form, &$form_state, $form_id) {

	$form['emh_baseline'] = array(
    '#markup' => '<p class="emh-title-baseline">' . t('Want to learn more?') . '<br /><strong>' . t('Leave us a message, we will get back at you within 24h!') . '</strong></p>',
    '#weight' => '-1000', // First !
  );

	$form['firstname'] = array(
		'#title' => t('Your first name'),
		'#type' => 'textfield',
		'#required' => TRUE,
	);

	$form['lastname'] = array(
		'#title' => t('Your last name'),
		'#type' => 'textfield',
		'#required' => TRUE,
	);

	$form['mail'] = array(
		'#title' => t('Your email'),
		'#type' => 'textfield',
		'#required' => TRUE,
	);

	$form['question'] = array(
		'#title' => t('Your question'),
		'#type' => 'textarea',
		'#required' => TRUE,
	);

	$form['name']['#required'] = FALSE;
	$form['name']['#type'] = 'hidden';

	$form['cid']['#type'] = 'hidden';

	$form['subject']['#required'] = FALSE;
	$form['subject']['#type'] = 'hidden';

	$form['copy']['#type'] = 'hidden';

	$form['actions']['submit']['#value'] = t('Send');

	$form['#token'] = NULL;

	$order = array('name', 'mail', 'subject','location', 'cid', 'message', 'copy', 'actions');

	foreach ($order as $key => $field) {
		$form[$field]['#weight'] = $key;
	}

	// echo '<pre>' . print_r($form, TRUE) . '</pre>';

}

function emh_faq_mail_alter(&$message) {
	if ($message['id'] == 'contact_page_mail') {
		$message['id'] = 'custom_contact_mail'; // Important, otherwise suject will be overriden
	 	$message['subject'] = $message['subject'].' '. t('From').' '.$message['from'];
	 	$message['body'][] = t('From - ').' '.$message['params']['firstname'].' '.$message['params']['lastname'];
		$message['body'][] = t('Telephone').': '.$message['params']['phone'];
		$message['body'][] = t('entreprise').': '.$message['params']['entreprise'];
	}
}
